import { type Category, type GameText } from "@prisma/client";
import Head from "next/head";
import { useState } from "react";
import { GameBoard } from "~/components/GameBoard";
import { GameCategories } from "~/components/GameCategories";
import { GameStats } from "~/components/GameStats";
import NoSSR from "~/components/NoSSR";
import { api } from "~/utils/api";

function Home() {
  const [correctCount, setCorrectCount] = useState(0);
  const [incorrectCount, setIncorrectCount] = useState(0);
  const [activeCategory, setActiveCategory] = useState<Category | null>(null);
  const [activeGame, setActiveGame] = useState<null | GameText>(null);
  const { data: categoryData } = api.gameRouter.getAllCategories.useQuery();

  const { data: games } = api.gameRouter.getAllGamesWithCategoryId.useQuery(
    activeCategory?.id || null,
    { enabled: !!activeCategory }
  );

  return (
    <>
      <Head>
        <title>QuickTyper</title>
        <meta name="description" content="Generated by create-t3-app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>

      <main className="flex min-h-screen flex-col items-center justify-center border-r-8 bg-gradient-to-b from-[#2e026d] to-[#15162c] px-24">
        <GameCategories
          categoryData={categoryData || []}
          gamesData={games || []}
          activeCategory={activeCategory}
          setActiveCategory={setActiveCategory}
          setActiveGame={setActiveGame}
          gameData={activeGame}
        />
        <GameStats
          correctCount={correctCount}
          incorrectCount={incorrectCount}
        />
        <NoSSR>
          {activeGame && (
            <GameBoard
              setCorrectCount={setCorrectCount}
              setIncorrectCount={setIncorrectCount}
              gameText={activeGame}
            />
          )}
        </NoSSR>
      </main>
    </>
  );
}

export default function HomePage(props: any) {
  return (
    // <NoSSR>
    <Home />
    // </NoSSR>
  );
}
